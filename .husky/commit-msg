#!/usr/bin/env bash

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(<"$COMMIT_MSG_FILE")

# Express√£o regular para Conventional Commits compat√≠vel com Bash
CONVENTIONAL_COMMIT_REGEX="^(feat|fix|docs|style|refactor|test|chore|build|ci|perf|revert)(\([a-zA-Z0-9_.-]+\))?(!)?: .+"

if [[ ! "$COMMIT_MSG" =~ $CONVENTIONAL_COMMIT_REGEX ]]; then
  echo
  echo "‚ùå ERRO: A mensagem de commit n√£o segue o formato do Conventional Commits."
  echo
  echo "‚úÖ Formato correto:"
  echo "  <tipo>(<escopo opcional>): <descri√ß√£o>"
  echo
  echo "üìö Tipos permitidos:"
  echo "  feat:     Uma nova funcionalidade."
  echo "  fix:      Corre√ß√£o de um bug."
  echo "  docs:     Altera√ß√µes na documenta√ß√£o."
  echo "  style:    Estilo de c√≥digo (espa√ßos, ponto-e-v√≠rgula, etc.)"
  echo "  refactor: Refatora√ß√£o sem mudan√ßa de comportamento."
  echo "  test:     Inclus√£o/modifica√ß√£o de testes."
  echo "  chore:    Tarefas administrativas (build, deps)."
  echo "  build:    Altera√ß√µes em processos de build ou depend√™ncias."
  echo "  ci:       Integra√ß√£o cont√≠nua."
  echo "  perf:     Melhorias de performance."
  echo "  revert:   Reverte um commit."
  echo
  echo "üìå Exemplos v√°lidos:"
  echo "  feat(auth): adicionar login com Google"
  echo "  fix(api)!: corrigir bug de timeout"
  echo "  docs(readme): atualizar instru√ß√µes"
  echo

  exit 1
fi

exit 0
